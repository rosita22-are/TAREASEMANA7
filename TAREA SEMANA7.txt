# Tarea Semana 7: Implementación de Constructores y Destructores en Python


class Archivo:
    def __init__(self, nombre, modo):
        """
        Constructor de la clase Archivo.
        Se ejecuta automáticamente cuando se crea un objeto Archivo.

        Inicializa:
        - nombre del archivo
        - modo de apertura
        - abre el archivo y guarda la referencia
        """
        self.nombre = nombre
        self.modo = modo
        self.archivo = open(nombre, modo)
        print(f"[INIT] Archivo '{self.nombre}' abierto en modo '{self.modo}'.")

    def escribir(self, texto):
        self.archivo.write(texto)

    def __del__(self):
        """
        Destructor de la clase Archivo.
        Se ejecuta cuando el objeto es destruido o deja de existir.

        Intenta realizar la limpieza de recursos:
        - cerrar el archivo si aún está abierto

        Este método puede ejecutarse cuando:
        - el programa finaliza
        - el objeto es eliminado con del
        - el recolector de basura lo detecta sin referencias
        """
        try:
            if not self.archivo.closed:
                self.archivo.close()
                print(f"[DEL] Archivo '{self.nombre}' cerrado correctamente.")
        except AttributeError:
            print("[DEL] El archivo ya había sido cerrado.")

from modelos.archivo import Archivo

class ArchivoService:
    """
    Clase de servicio que contiene la lógica del sistema.
    Se encarga de gestionar las acciones relacionadas con archivos.
    """

    def crear_archivo(self, nombre):
        archivo = Archivo(nombre, "w")
        return archivo

    def escribir_en_archivo(self, archivo, texto):
        archivo.escribir(texto)

    def cerrar_archivo(self, archivo):
        """
        Elimina la referencia al objeto para forzar
        la llamada al destructor (__del__).
        """
        del archivo
        print("[SERVICE] Referencia al archivo eliminada.")

from servicios.archivo_service import ArchivoService

if __name__ == "__main__":
    print("Inicio del programa")

    service = ArchivoService()

    # Se crea el archivo (se ejecuta __init__)
    archivo = service.crear_archivo("ejemplo.txt")

    # Se escribe contenido en el archivo
    service.escribir_en_archivo(archivo, "Hola, este archivo usa constructores y destructores.\n")

    # Se elimina el objeto (se ejecuta __del__)
    service.cerrar_archivo(archivo)

    print("Fin del programa")
```

